var CatarseMixpanel=window.CatarseMixpanel={$el:$("body"),activate:function(){this.VISIT_MIN_TIME=4e3,this.user=null,this.controller=this.$el.data("controller")||this.$el.data("controller-name"),this.action=this.$el.data("action"),this.user=this.$el.data("user"),this.id=this.$el.data("id"),window.mixpanel&&(this.detectLogin(),this.startTracking())},projectProperties:function(){return $("*[data-stats]").data("stats")},startTracking:function(){var t=this;this.trackOnPage("projects","show",function(){t.trackVisit("Visited project page",t.projectProperties()),t.trackReminderClick(),t.trackOnContributionStart()}),this.trackProjectDashboard=function(){"#reports"==window.location.hash&&t.track("Project owner engaged with Catarse",_.extend(t.projectProperties(),{action:"Visited reports"})),"#home"==window.location.hash&&t.track("Project owner engaged with Catarse",_.extend(t.projectProperties(),{action:"Visited insights"}))},this.trackOnPage("projects","edit",function(){$(window).on("hashchange",function(){t.trackProjectDashboard()})}),this.trackOnPage("pages","show",function(){"start"==t.id&&t.track("Visited start page")}),this.trackPageVisit("projects","new","Visited new project page"),this.trackPageVisit("projects","index","Visited home"),this.trackPageVisit("explore","index","Explored projects"),this.trackPageLoad("contributions","edit","Selected reward"),this.trackPageLoad("contributions","show","Finished Contribution"),this.trackProjectDashboard(),this.trackContributions(),this.trackPaymentChoice(),this.trackTwitterShare(),this.trackFacebookShare(),this.trackFollowCategory();try{this.trackOnFacebookLike(),this.trackOnFacebookComment()}catch(t){console.log(t)}},trackFollowCategory:function(){var t=this;$(".category-follow .follow-btn").on("click",function(e){return t.track("Engaged with Catarse",{ref:$(e.currentTarget).data("title"),action:"click follow category"}),!0})},trackOnContributionStart:function(){var t=this;$(".card-reward").on("click",function(){t.trackStartedContribution("Reward click")}),$("#contribute_project_form").on("click",function(){t.trackStartedContribution("Contribute button click")})},trackStartedContribution:function(t){this.track("Started contribution",_.extend(this.projectProperties(),{action:t}))},trackReminderClick:function(){var t=this;$("#project-reminder > a").on("click",function(e){return $(e.target).hasClass("link-hidden-success")||t.track("Engaged with Catarse",{ref:$(e.currentTarget).data("title"),action:"click reminder"}),!0})},trackPageLoad:function(t,e,i){var r=this;this.trackOnPage(t,e,function(){r.track(i)})},trackContributions:function(){var t="",e=this;this.trackOnPage("contributions","new",function(){t=window.location.href.indexOf("reward_id")>-1?"Reward click":"Contribute button click",e.track("Started contribution",_.extend(e.projectProperties(),{action:t}))})},trackPaymentChoice:function(){var t=this;$("#engine").on("click",".back-payment-radio-button",function(){var e=$(".back-payment-radio-button:checked").val();"slip"===e&&t.track("Payment chosen",_.extend(t.projectProperties(),{payment_choice:"BoletoBancario"})),"credit_card"===e&&t.track("Payment chosen",_.extend(t.projectProperties(),{payment_choice:"CartaoDeCredito"}))})},trackPageVisit:function(t,e,i){var r=this;this.trackOnPage(t,e,function(){r.trackVisit(i)})},trackOnPage:function(t,e,i){this.controller==t&&this.action==e&&i()},trackTwitterShare:function(){var t=this;$("#twitter_share_button").on("click",function(e){t.track("Engaged with Catarse",{ref:$(e.currentTarget).data("title"),action:"share twitter"})})},trackFacebookShare:function(){var t=this;$("a#facebook_share").on("click",function(e){t.track("Engaged with Catarse",{ref:$(e.currentTarget).data("title"),action:"share facebook"})})},trackOnFacebookComment:function(){var t=this;FB.Event.subscribe("comment.create",function(e,i){t.track("Engaged with Catarse",{ref:$(i).data("title"),action:"comment facebook"})})},trackOnFacebookLike:function(){var t=this;FB.Event.subscribe("edge.create",function(e,i){t.track("Engaged with Catarse",{ref:$(i).data("title"),action:"like facebook"})})},onLogin:function(){this.user.created_today?(mixpanel.alias(this.user.user_id),this.track("Signed up")):this.track("Logged in")},detectLogin:function(){this.user?this.user.user_id!=store.get("user_id")&&(this.onLogin(),store.set("user_id",this.user.user_id)):store.get("user_id")&&(mixpanel&&mixpanel.cookie&&mixpanel.cookie.clear(),store.set("user_id",null))},identifyUser:function(){this.user&&(mixpanel.name_tag(this.user.email),mixpanel.identify(this.user.user_id),mixpanel.people.set({$email:this.user.email,$created:this.user.created,$last_login:this.user.last_login,contributions:this.user.contributions}))},track:function(t,e){this.identifyUser();var i=e||{},r=$(this),a=r.attr("href")!=undefined?r.attr("href"):i.ref?i.ref:null,n=this.user||{},o={"page name":document.title,url:window.location,host:window.location.host,from_page:this.$el.data("referral")},i=$.fn.extend(n,i,o,{project:a});mixpanel.track(t,i)},mixPanelEvent:function(t,e,i,r){var a=this;$(t).on(e,function(){a.track(i,r)})},trackVisit:function(t,e){var i=this;window.setTimeout(function(){i.track(t,e)},this.VISIT_MIN_TIME)}};